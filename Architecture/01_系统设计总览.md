# 自动化小说编写框架 (Nōva Architecture)

## 1. 核心设计理念

本框架旨在构建一个**“人机耦合” (Human-in-the-loop)** 的创作系统。系统不应该是一个单向的生成器，而是一个可交互的虚拟编辑部。

### 关键特性
*   **状态共享 (Shared Context)**：所有 Agent 基于同一个“黑板”（Blackboard）工作，任何修改都会实时反映在共享状态中。
*   **混合模式 (Hybrid Mode)**：支持三种运行模式的动态切换。
    *   **Auto (全自动)**：AI 自主决策，适合快速生成初稿或寻找灵感。
    *   **Co-pilot (副驾驶)**：AI 生成选项或草稿，必须由用户确认或修改后才能进入下一步。
    *   **Manual (手动)**：用户直接接管，AI 仅作为辅助工具（提供润色、检查）。
*   **分形结构 (Fractal Structure)**：从“整书”到“卷”到“章”到“场景”，每一层级都复用相同的“规划-执行-评估”循环。

---

## 2. 角色定义 (Role Definitions)

### 2.1 总导演 (The Director / Orchestrator)
*   **身份**：系统的核心调度中枢，类似主编或项目经理。
*   **职责**：
    *   解析用户意图（如：“把这一章改得更悲伤一点” -> 转化为 Writer 和 Editor 的具体指令）。
    *   维护全局进度（Workflow State）。
    *   决定何时呼叫哪个 Expert Agent。
*   **交互**：直接面向用户。

### 2.2 设定架构师 (World Builder)
*   **身份**：负责构建静态世界的工程师。
*   **职责**：
    *   **世界观生成**：生成地理、历史、力量体系、社会制度。
    *   **一致性维护**：确保后续剧情不违背基础设定（如：低魔世界不能出现禁咒）。
    *   **道具/概念管理**：维护一个动态的“名词解释表”。
*   **对应方法论**：`01_Plus_世界观_搭建舞台.md`

### 2.3 角色总监 (Casting Director)
*   **身份**：负责演员管理和选角。
*   **职责**：
    *   **角色卡生成**：外貌、性格、背景、核心冲突、口癖。
    *   **人物弧光 (Character Arc)**：规划角色的成长路径和关键转折点。
    *   **状态追踪**：记录角色当前的状态（受伤、富有、愤怒等）。
*   **对应方法论**：`02_角色塑造_捏人指南.md`

### 2.4 剧情结构师 (The Outliner)
*   **身份**：负责故事骨架的建筑师。
*   **职责**：
    *   **分层规划**：全书大纲 -> 卷纲 -> 章纲 -> 场景节拍 (Beat Sheet)。
    *   **节奏控制**：控制爽点、危机点、高潮点的分布。
    *   **伏笔管理**：在早期埋下线索，并规划回收时机。
*   **对应方法论**：`01_准备阶段_素材与大纲.md`, `04_进阶技巧_伏笔与填坑.md`

### 2.5 执行主笔 (The Writer)
*   **身份**：前线作战的撰稿人。
*   **职责**：
    *   **场景扩写**：将简短的“场景节拍”转化为 2000-3000 字的正文。
    *   **风格切换**：根据要求切换文风（白描、华丽、幽默）。
    *   **感官描写**：调用五感描写增强代入感。
*   **对应方法论**：`03_实战过程_边写边修.md`

### 2.6 审校编辑 (The Editor / Critic)
*   **身份**：质量把关者。
*   **职责**：
    *   **逻辑检查**：发现剧情漏洞。
    *   **OOC 检查**：警告角色行为是否符合人设。
    *   **润色建议**：优化冗余词句，提升文学性。

---

## 3. 协同合作工作流 (Collaboration Workflow)

### 场景：编写新的一章

#### Phase 1: 规划 (Planning)
1.  **Director** 检查当前进度，确定下一章目标。
2.  **StructureAgent** 读取前文摘要和后续大纲，生成本章的 **细纲 (Beat Sheet)**。
    *   *Check Point (Co-pilot)*: 用户审查细纲。用户可能会说：“增加一个反派突袭的情节”。
    *   **StructureAgent** 根据反馈修改细纲。

#### Phase 2: 准备 (Pre-writing)
1.  **Director** 提取本章涉及的 **角色 (Active Characters)** 和 **场景 (Locations)**。
2.  **CharAgent** 和 **WorldAgent** 准备相关的背景资料注入到 Context 中（减少 Token 消耗，防幻觉）。

#### Phase 3: 撰写 (Writing)
1.  **WriterAgent** 逐个场景进行描写。
    *   *Input*: 细纲 Node A + 角色状态 + 环境设定。
    *   *Process*: 生成草稿。
2.  **Director** 更新 Context 中的“已发生剧情”。

#### Phase 4: 审查 (Review)
1.  **ReviewAgent** 读取草稿。
2.  检查项：是否偏离大纲？人物语气对吗？有无逻辑硬伤？
3.  *Output*: 修改意见 or 通过信号。

#### Phase 5: 交付 (Delivery)
1.  用户看到生成的正文。
2.  *Interaction*: 用户可以直接修改正文，或者要求 WriterAgent 重写某一段。

---

## 4. 自由切换机制 (Switching Mechanism)

为了实现自由切换，我们需要将“编写”拆解为原子化的**Task Units**。

**关键设计：Task Config**

每个 Task（如“生成大纲”、“生成对话”）都有一个配置项：
```json
{
  "taskType": "GENERATE_SCENE",
  "executionMode": "CO_PILOT", // AUTO | CO_PILOT | MANUAL
  "constraints": ["no_killing", "funny_tone"]
}
```

*   **从 AI 编写切换到用户编写**：
    用户点击“暂停/接管”。Director 将当前 Task 标记为 `MANUAL`。系统停止生成，进入监听状态，等待用户提交文本更新 Blackboard。

*   **从用户编写切换到 AI 续写**：
    用户写了一半卡住了，点击“AI 续写”。Director 创建一个新的 `GENERATE_CONTINUATION` Task，模式设为 `AUTO` 或 `CO_PILOT`，WriterAgent 读取用户刚写的内容作为 Context 继续生成。

---

## 5. 技术栈建议

*   **LLM Orchestration**: LangChain / LangGraph (非常适合这种有环图的状态机)
*   **Backend**: Python (FastAPI) or Node.js
*   **Frontend**: React (需要富文本编辑器 + 侧边栏对话框)
*   **Database**: 
    *   JSON/Document Store (MongoDB) 存设定和大纲。
    *   Vector DB (Chroma/Pinecone) 存剧情历史，用于 RAG。
